<header class="bg-card border-b border-border shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      <!-- Logo and Brand -->
      <div class="flex items-center">
        <div class="flex-shrink-0 flex items-center">
          <mat-icon class="text-primary text-2xl mr-3">construction</mat-icon>
          <span class="text-xl font-bold text-foreground">Bau Platform</span>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8">
        <!-- Dashboard - always visible when any user state is active -->
        @if (isAuthenticated()) {
          <a routerLink="/dashboard" 
             routerLinkActive="text-primary" 
             class="text-foreground hover:text-primary transition-colors">
            Dashboard
          </a>
        }
        
        <!-- Bedarfe and Betriebe - only for authenticated users (not logged out) -->
        @if (effectivelyAuthenticated()) {
          <a routerLink="/bedarfe" 
             routerLinkActive="text-primary" 
             class="text-foreground hover:text-primary transition-colors">
            Bedarf
          </a>
          <a routerLink="/betriebe" 
             routerLinkActive="text-primary" 
             class="text-foreground hover:text-primary transition-colors">
            Betriebe
          </a>
        }
        
        <!-- About Us - always visible for all users -->
        <a routerLink="/about" 
           routerLinkActive="text-primary" 
           class="text-foreground hover:text-primary transition-colors">
          Über uns
        </a>
      </nav>

      <!-- User Menu -->
      <div class="flex items-center space-x-4">
        <!-- Theme Toggle (Always visible) -->
        <button 
          (click)="toggleTheme()"
          class="p-2 text-muted-foreground hover:text-foreground transition-colors"
          [title]="getThemeTooltip()">
          <mat-icon>{{ getThemeIcon() }}</mat-icon>
        </button>

        @if (isAuthenticated()) {
          <!-- Role Selector (Development Only) -->
          @if (showRoleSelector()) {
            <div class="hidden md:block">
              <select 
                [value]="localRole() || user()?.role || ''"
                (change)="onRoleSelectChange($event)"
                class="text-sm px-3 py-1 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary">
                <option value="">Abgemeldet</option>
                <option [value]="UserRole.ADMIN">{{ getRoleDisplayName(UserRole.ADMIN) }}</option>
                <option [value]="UserRole.BETRIEB">{{ getRoleDisplayName(UserRole.BETRIEB) }}</option>
              </select>
            </div>
          }

          <!-- User Info -->
          <div class="hidden md:flex items-center space-x-3">
            <div class="text-right">
              <p class="text-sm font-medium text-foreground">{{ user()?.name }}</p>
              <p class="text-xs text-muted-foreground">{{ getRoleDisplayName(user()?.role || UserRole.BETRIEB) }}</p>
            </div>
            <button 
              (click)="logout()"
              class="p-2 text-muted-foreground hover:text-foreground transition-colors"
              title="Abmelden">
              <mat-icon>logout</mat-icon>
            </button>
          </div>

          <!-- Mobile Menu Button -->
          <button 
            (click)="toggleMobileMenu()"
            class="md:hidden p-2 text-foreground hover:text-primary transition-colors">
            <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
          </button>
        } @else {
          <!-- Not authenticated - show login link and mobile menu -->
          <div class="flex items-center space-x-2">
            <a routerLink="/login" 
               class="text-foreground hover:text-primary transition-colors">
              Anmelden
            </a>
            <!-- Mobile Menu Button for non-authenticated users -->
            <button 
              (click)="toggleMobileMenu()"
              class="md:hidden p-2 text-foreground hover:text-primary transition-colors">
              <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Mobile Menu -->
    @if (mobileMenuOpen()) {
      <div class="md:hidden border-t border-border">
        <div class="px-2 pt-2 pb-3 space-y-1">
          <!-- Dashboard - visible when authenticated -->
          @if (isAuthenticated()) {
            <a routerLink="/dashboard" 
               (click)="closeMobileMenu()"
               routerLinkActive="text-primary bg-primary/10" 
               class="block px-3 py-2 rounded-md text-base font-medium text-foreground hover:text-primary hover:bg-primary/10 transition-colors">
              Dashboard
            </a>
          }
          
          <!-- Bedarfe and Betriebe - only for effectively authenticated users -->
          @if (effectivelyAuthenticated()) {
            <a routerLink="/bedarfe" 
               (click)="closeMobileMenu()"
               routerLinkActive="text-primary bg-primary/10" 
               class="block px-3 py-2 rounded-md text-base font-medium text-foreground hover:text-primary hover:bg-primary/10 transition-colors">
              Bedarf
            </a>
            <a routerLink="/betriebe" 
               (click)="closeMobileMenu()"
               routerLinkActive="text-primary bg-primary/10" 
               class="block px-3 py-2 rounded-md text-base font-medium text-foreground hover:text-primary hover:bg-primary/10 transition-colors">
              Betriebe
            </a>
          }
          
          <!-- About Us - always visible for all users -->
          <a routerLink="/about" 
             (click)="closeMobileMenu()"
             routerLinkActive="text-primary bg-primary/10" 
             class="block px-3 py-2 rounded-md text-base font-medium text-foreground hover:text-primary hover:bg-primary/10 transition-colors">
            Über uns
          </a>
          
          @if (isAuthenticated()) {
            <!-- Mobile Theme Toggle -->
            <div class="px-3 py-2 border-t border-border">
              <button 
                (click)="toggleTheme(); closeMobileMenu()"
                class="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors">
                <mat-icon class="text-base">{{ getThemeIcon() }}</mat-icon>
                {{ getThemeTooltip() }}
              </button>
            </div>
            
            <!-- Mobile Role Selector -->
            @if (showRoleSelector()) {
              <div class="px-3 py-2">
                <label for="mobile-role-selector" class="block text-xs font-medium text-muted-foreground mb-1">Entwicklungsrolle</label>
                <select 
                  id="mobile-role-selector"
                  [value]="localRole() || user()?.role || ''"
                  (change)="onRoleSelectChange($event)"
                  class="w-full text-sm px-3 py-1 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary">
                  <option value="">Abgemeldet</option>
                  <option [value]="UserRole.ADMIN">{{ getRoleDisplayName(UserRole.ADMIN) }}</option>
                  <option [value]="UserRole.BETRIEB">{{ getRoleDisplayName(UserRole.BETRIEB) }}</option>
                </select>
              </div>
            }
            
            <!-- Mobile User Info -->
            <div class="px-3 py-2 border-t border-border">
              <p class="text-sm font-medium text-foreground">{{ user()?.name }}</p>
              <p class="text-xs text-muted-foreground mb-2">{{ getRoleDisplayName(user()?.role || UserRole.BETRIEB) }}</p>
              <button 
                (click)="logout()"
                class="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors">
                <mat-icon class="text-base">logout</mat-icon>
                Abmelden
              </button>
            </div>
          }
        </div>
      </div>
    }
    
    <!-- Mobile Menu for Non-Authenticated Users -->
    @if (!isAuthenticated() && mobileMenuOpen()) {
      <div class="md:hidden border-t border-border">
        <div class="px-2 pt-2 pb-3 space-y-1">
          <!-- About Us - always visible -->
          <a routerLink="/about" 
             (click)="closeMobileMenu()"
             routerLinkActive="text-primary bg-primary/10" 
             class="block px-3 py-2 rounded-md text-base font-medium text-foreground hover:text-primary hover:bg-primary/10 transition-colors">
            Über uns
          </a>
          
          <!-- Mobile Theme Toggle -->
          <div class="px-3 py-2 border-t border-border">
            <button 
              (click)="toggleTheme(); closeMobileMenu()"
              class="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors">
              <mat-icon class="text-base">{{ getThemeIcon() }}</mat-icon>
              {{ getThemeTooltip() }}
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</header>
